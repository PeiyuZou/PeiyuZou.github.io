## 存储器概览

计算机的存储设备可以分为以下几种：

- 寄存器（集成在 CPU 内部）
- CPU Cache（集成在 CPU 内部）
    - L1 Cache
    - L2 Cache
    - L3 Cache
- 内存
- 硬盘
    - SSD
    - HDD

### 寄存器

寄存器最靠近 CPU 的控制单元和逻辑计算单元的存储器，它的速度在所有存储器中是最快的，同样价格也是最昂贵的。

寄存器的访问速度非常快，一般要求在半个 CPU 时钟周期内完成读写，CPU 时钟周期跟 CPU 主频息息相关，比如 2 GHz 主频的 CPU，那么它的时钟周期就是 1/2G，也就是 0.5ns（纳秒）。

CPU 处理一条指令的时候，除了读写寄存器，还需要解码指令、控制指令执行和计算。如果寄存器的速度太慢，则会拉长指令的处理周期，导致电脑运行过慢。

### CPU Cache

CPU Cache 用的是一种叫 SRAM（Static Random-Access Memory，静态随机存储器）的芯片。

SRAM 需要通电来保持数据存在，它之所以被称为 “静态” 是因为它不靠电容存储，不用定期刷新电容来保持数据，只需要保持通电就行。SRAM 的结构简单，所以访问速度非常快。

CPU 的高速缓存通常分为 L1、L2、L3 三层，如下图：

![CPU Cache](memory_01.png)
/// caption
CPU Cache
///

#### L1 高速缓存

L1 Cache 的访问速度几乎和寄存器一样快，通常在 2 ~ 4 个时钟周期，大小在几十 KB 到几百 KB 不等。

从上图可以看出，每个 CPU 都有一块属于自己的 L1 Cache，指令和数据在 L1 是分开存放的，分为了指令缓存和数据缓存

#### L2 高速缓存

L2 高速缓存同样每个 CPU 核心都有，但是 L2 高速缓存位置比 L1 高速缓存距离 CPU 核心更远，它大小比 L1 高速缓存更大，通常大小在几百 KB 到几 MB 不等。访问速度在 10 ~ 20 个时钟周期。

#### L3 高速缓存

L3 高速缓存通常是多个 CPU 核心共用的，位置比 L2 高速缓存距离 CPU 核心更远，大小在几 MB 到几十 MB 不等，访问速度在 20 ~ 60 个时钟周期。


### 内存

内存使用的芯片是 DRAM （Dynamic Random Access Memory，动态随机存取存储器）

相比 SRAM，DRAM 的密度更高，功耗更低，有更大的容量，而且造价比 SRAM 芯片便宜很多。

DRAM 存储一个 bit 数据，只需要一个晶体管和一个电容就能存储，但是因为数据会被存储在电容里，电容会不断漏电，所以需要「定时刷新」电容，才能保证数据不会被丢失，这就是 DRAM 之所以被称为「动态」存储器的原因，只有不断刷新，数据才能被存储起来。

DRAM 的数据访问电路和刷新电路都比 SRAM 更复杂，所以访问的速度会更慢，内存速度大概在 200 ~ 300 个 时钟周期之间。

### 硬盘

SSD（Solid-state disk）就是我们常说的固态硬盘，结构和内存类似，但是它相比内存的优点是断电后数据还是存在的，而内存、寄存器、高速缓存断电后数据都会丢失，它的读写速度比内存慢 10 ~ 1000 倍。

HDD（Hard Disk Drive）是传统的机械硬盘，它的访问速度更慢，比内存慢 10w 倍左右。

近年的 SSD 价格已经逐渐平民化，渐渐地开始取代 HDD 了。


## 存储器的层次关系

这些存储器之间的关系图如下所示：

![存储器的层次关系](memory_02.png)
/// caption
存储器的层次关系
///

!!! warning 注意
    存储器只会和相邻的一层存储器设备打交道。比如 L1 Cache 只会和 L2 Cache 、寄存器两者打交道。CPU 要访问内存中的某个数据时，首先会查寄存器有没有，有的话直接取。没有的话访问 L1 ，一直这样重复下去，都没有的话，才去访问内存。

有一个很好的例子可以帮助加深理解：

想象一下你在图书馆里面看书，你的大脑就是 CPU ，寄存器相当于存放了当前你正在思考的东西，L1 ~ L3 则是代表短期和长期的记忆，可以快速访问。当你想不起一个知识点的时候，你拿起书桌上的书查阅，书桌上的书相当于是内存，它比记忆更慢需要动手翻阅。如果这本书上的内容也不是想要的，那么就需要起身去书架上找，书架相当于是硬盘，它更慢了，但是可以存更多的东西。