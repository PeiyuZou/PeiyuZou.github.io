我们所说的内存通常有多个含义，从操作系统管理层面可以将内存分为**物理内存**和**虚拟内存**

## 物理内存

物理内存通常指 RAM (Random Access Memory)，具有以下特点：

- 易失性：断电后数据会丢失
- 高速访问：比硬盘等存储设备快得多
- 随机访问：可以直接访问任意地址的数据
- 临时存储：用于存放正在运行的程序和数据

物理内存层面我们需要关注两个点：CPU 访问内存的过程、移动设备的内存架构差异

### CPU 访问内存是一个慢速的过程

CPU 在访问内存之前，会先去依次访问 L1、L2、L3 Cache，如果没有得到想要的数据（称为一次 Cache Miss），则会访问主内存，然后回到 Cache。整个这个过程是比较慢的，如果执行指令或者内存地址不连续，这个过程会导致大量的 Cache Miss，造成大量的主内存和 Cache 之间的交换，大量的时间会被浪费在内存的读取上。

所以物理内存的一个核心问题是如何减少 Cache Miss。Unity 推出的 DOTS 技术的一个理念就是把不连续的内存尽量变为连续的内存，以此减少 Cache Miss。

### 移动设备的内存架构差异

目前市面上大多数的移动设备都没有独立的 GPU 和独立的显存，通常是 CPU 同时肩负着 GPU 的职责，因此一般用于显示渲染的资产会在内存中存在两份：

- 一份是加载到内存中的原始数据，它们由 Unity 管理起来，当 CPU 需要读取或修改资源时使用。
- 另外一份是在 “显存” 中的副本，它们是经过压缩、格式转换后的 GPU 友好的，实际用于渲染的数据格式，可以被直接高速访问用于渲染。

另外，移动设备 CPU 的板载面积也更小，缓存级数更少，缓存大小更小。移动设备 CPU 访问内存的效率比 PC 等平台更低，代价更大。

## 虚拟内存

虚拟内存（Virtual memory）是计算机系统内存管理的一种技术。它使得应用程序认为它拥有连续可用的内存（一个连续完整的地址空间），而实际上物理内存通常被分隔成多个内存碎片，还有部分暂时存储在外部磁盘存储器上，在需要时进行数据交换。与没有使用虚拟内存技术的系统相比，使用这种技术使得大型程序的编写变得更容易，对真正的物理内存（例如 RAM ）的使用也更有效率。此外，虚拟内存技术可以使多个进程共享同一个运行库，并通过分割不同进程的内存空间来提高系统的安全性。

要注意的是，虚拟内存不只是 “用磁盘空间来扩展物理内存” 的意思——这只是扩充内存级别以使其包含硬盘驱动器而已。把内存扩展到磁盘只是使用虚拟内存技术的一个结果，它的作用也可以通过覆盖或者把处于不活动状态的程序以及它们的数据全部交换到磁盘上等方式来实现。对虚拟内存的定义是基于对地址空间的重定义的，即把地址空间定义为 “连续的虚拟内存地址”，以借此 “欺骗” 程序，使它们以为自己正在使用一大块的 “连续” 地址。

![虚拟内存](VirtualMem01.png)
/// caption
虚拟内存
///

### 内存交换和内存压缩

内存交换是指设备将无用的内存数据写入到硬盘，以腾出内存空间的行为。PC 设备支持内存交换，移动设备不支持，不支持的原因有以下两点：

- 移动设备的 IO 性能较差，做内存交换会严重影响性能
- 移动设备的外置存储可擦写次数较少，频繁的内存交换会减少外置存储的寿命

为了解决这个问题，iOS 支持了内存压缩（Android 不支持），大致原理是把无用的内存数据压缩起来放到指定位置，以此节省内存空间。