Android 是基于 Linux 的操作系统，所以 Android 的内存管理与 Linux 的内存管理是类似的。

## 内存基本单位

它的内存基本单位是一个 Page，大小为 4KB（不代表所有数据是按照 4KB 进行内存对齐）。回收和分配以 Page 为单位。内存空间分为内核态和用户态，内核态的内存是用户态严格禁止访问的。

## low memory killer

!!! note "详细介绍参考"
    https://developer.android.com/games/optimize/vitals/lmk?hl=zh-cn

![Android 进程，从上到下，优先级递增](2025-07-09T232219.png)
/// caption
虚拟内存
///

lmk 的原理是根据进程的优先级，在内存不足时，优先杀死优先级低的进程。所以一般在前台游戏进程分配过多内存时，优先杀掉了后台进程，如果内存分配还在继续，则肯呢个会影响到声音、桌面，甚至杀掉当前前台进程，如果前台进程被杀掉时，内存分配没有来得及释放，则可能会导致系统崩溃，也就是最高到 System 这一级别。Native 内核层不会受影响。

lmk 通常受到忽略，比如后台被杀掉的其他进程，或者音乐停了，但是游戏还在运行。但我们仍然需要关注，这变向地暴露了游戏内存的过多分配。

## 内存指标

- RSS：Resident Set Size，常驻内存。
- PSS：Proportional Set Size，比例内存。
- USS：Unique Set Size，唯一内存。

RSS 是你的应用占用的内存 + 由于调用公共库，公共库所分配出来的内存。PSS 和 RSS 类似，但是会根据公共库的共享程度进行比例分配，比如公共库被 10 个进程使用，它被分配了 10MB 的内存，那么每个进程的 PSS 就是 1MB。USS 是你的应用占用的内存，不包括公共库的内存。

所以一般如果我们 RSS 高但 USS 低，说明我们调用了某个复杂度较高的公共库。这些内存指标可以通过 Procrank 工具（一款用于 Android 平台的内存分析工具）查看。